<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="description" content="WhatsUp 2">
    
    <title>WhatsUp 2</title>

    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css">

    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/socket.js"></script>
  </head>
  <body>
    <!--Nav header of the page.-->
    <nav class="navbar navbar-dark bg-dark">
      <li class="logo"><img alt="WhatsUp 2 Logo" src="icons/logo.png" /></li>
      <li><a href="#"><button class="btn btn-outline-primary">Mensajes</button></a></li>
      <li><a href="#"><button class="btn btn-outline-primary">Pase de batalla</button></a></li>
      <li><a href="#"><button class="btn btn-outline-primary">Tienda</button></a></li>
      <li>
        <img src="icons/user.png" alt="Foto de perfil">
        <a href="#"><button class="btn btn-outline-primary">Perfil</button></a>
      </li>
    </nav>

    <!--Main content of the page.-->
    <div class="flex-container">
      <div id="chats">
        <p>CHATS</p>
      </div>

      <div id="messages-main">
        <div id="chat-header">
          <p id="chat-name">CHAT GENERAL</p>
        </div>

        <!--Messages-->
        <div id="chat-content">
          <div id="chat-logged"><p></p></div>
        </div>

        <footer class="chat-footer">
          <button id="emojisBtn">&#128514;</button>
          <textarea id="messageArea" class="form-control" placeholder="Escribe aquí tu mensaje..."></textarea>
          <button onclick="sendMessage();" id="sendMessageBtn" type="submit" tabindex="-1"><i class="fa fa-paper-plane sendIcon" aria-hidden="true"></i></button>
        </footer>
      </div>

      <div id="chat-info">
        <p>Usuarios conectados</p>
        <ul id="userList"></ul>
      </div>
    </div>
    
    <script>
      //Esto es temporal hasta que esté a base de datos
      //Reconocimiento de usuario | Futuramente esto será a través de la base de datos y será mucho más seguro, ahora tiene errores de seguridad.
      var user = prompt("¿Quién eres?");
      
      while (user == null) {
        user = prompt("Nombre inválido, repite el nick.");
      }

      user = user.replaceAll(/<[^>]+>/g, '');
      user = user.replaceAll('</', '')
      
      //Check de user not empty FRONT | Futuramente será a través del registro.
      while(user.trim() == "" || user.search(">") != -1 || user.search("<") != -1 || user.search('"') != -1 || user == null) {
        user = prompt("Nombre inválido, repite el nick.")
        user = user.replaceAll(/<[^>]+>/g, '');
        user = user.replaceAll(/<\//g, '')
      }

      $('document').ready(function() {
        var msg = JSON.stringify({from: user, type: "login"})
        ws.send(msg);
      });
    </script>
  </body>
</html>